<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Science Industrialization Boilerplate :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/opendevstack/3.x/quickstarters/ds-ml-service.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opendevstack" data-version="1.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../getting-started/index.html">OpenDevStack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../jenkins-shared-library/index.html">Jenkins Shared Library</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Quickstarters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-docker-plain.html">BE Docker Plain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-golang.html">BE Golang</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-java-springboot.html">BE Java / Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-node-express.html">BE Node Express</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-python-flask.html">BE Python Flask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="be-scala-akka.html">BE Scala Akka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fe-angular.html">FE Angular</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fe-ionic.html">FE Ionic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fe-react.html">FE React</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fe-vue.html">FE Vue</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="ds-ml-service.html">Data Science Machine Learning Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ds-jupyter-notebook.html">Data Science Jupyter Notebook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ds-rshiny-app.html">Data Science RShiny app</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airflow.html">Airflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-cypress.html">Cypress E2E testing Quickstarters</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../provisioning-app/index.html">Provisioning App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/configuration.html">Configuration Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/architecture.html">Internal Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/upgrade_notes.html">Upgrade Notes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../local-installation.html">Local Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sysenv-requirements.html">System and Environment Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../infrastructure-setup.html">Infrastructure Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jenkins/index.html">Jenkins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/webhook-proxy.html">Webhook Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/slave-base.html">Jenkins Slave Base Image</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shared Images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shared-images/openresty-nginx.html">OpenResty Base image + WAF</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shared-images/nginx-authproxy-crowd.html">Crowd Authproxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">SonarQube</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenDevStack</span>
    <span class="version">1.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenDevStack</span>
      <ul class="versions">
        <li class="version">
          <a href="../../4.x/getting-started/index.html">4.x Preview</a>
        </li>
        <li class="version is-latest">
          <a href="../../3.x/getting-started/index.html">3.x</a>
        </li>
        <li class="version">
          <a href="../../2.x/getting-started/index.html">2.x</a>
        </li>
        <li class="version is-current">
          <a href="../getting-started/index.html">1.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../3.x/getting-started/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../getting-started/index.html">OpenDevStack</a></li>
    <li><a href="index.html">Quickstarters</a></li>
    <li><a href="ds-ml-service.html">Data Science Machine Learning Service</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.x</button>
  <div class="version-menu">
    <a class="version" href="../../4.x/quickstarters/ds-ml-service.html">4.x Preview</a>
    <a class="version" href="../../3.x/quickstarters/ds-ml-service.html">3.x</a>
    <a class="version" href="../../2.x/quickstarters/ds-ml-service.html">2.x</a>
    <a class="version is-current" href="ds-ml-service.html">1.x</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-project-quickstarters/edit/1.2.x/docs/modules/quickstarters/pages/ds-ml-service.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Data Science Industrialization Boilerplate</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This boilerplate enables data scientists to develop, serve, version models within a CI/CD
pipeline hosted on OpenShift with the goal in mind that one does not have to take care/change
much of the needed pipeline and infrastructure.</p>
</div>
<div class="paragraph">
<p>For pull requests and discussion regarding direction, please pull in @hugowschneider, @sklingel and @gerardcl</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_setup"><a class="anchor" href="#_basic_setup"></a>Basic Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The boilerplate provides a two pod setup in OpenShift, one pod for training service and one pod for
prediction service.</p>
</div>
<div class="sect2">
<h3 id="_container_services"><a class="anchor" href="#_container_services"></a>Container services</h3>
<div class="paragraph">
<p>From one <code>Dockerfile</code>, under <code>docker</code> folder, both <code>training</code> and <code>prediction</code> services are built. If required, one can edit it in order to provide different dependency management workflows for each service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>training</code> service provides a pod that is able to reproduce/retrain the model that is
developed in the current commit either locally on OpenShift or execute the training on a remote
linux system using ssh. The training process is wrapped into a flask server to be able to monitor
 and possible restart the training process. Moreover, the training service offers an endpoint
 for downloading the created model afterwards. Additionally, unittests and
 integration tests are executed on the training pod, in order to not depend on operating
 dependencies in the jenkins slave.</p>
</li>
<li>
<p>The <code>prediction</code> service provides a simple flask service for getting new predictions out
of your model by making json posts to the prediction REST endpoint.
The prediction service is already built with the newly trained model from the training pod.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jenkins"><a class="anchor" href="#_jenkins"></a>Jenkins</h3>
<div class="paragraph">
<p>The <code>Jenkinsfile</code> organizes the correct succession of spinning up the training, executing it and
starting the new deployment of the prediction service.
Additionally, it triggers unittest ensuring the code is functionally before a new training
process is started.
 Moreover, integration tests are run against the reproduced model wrapped into the prediction
 REST endpoint to
ensure that the reproduced model (performance) behaves as expected also when wrapped in the flask
service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_files"><a class="anchor" href="#_external_files"></a>External Files</h3>
<div class="paragraph">
<p>External files that are needed either for building your model or docker
images are stored
under
<code>resources</code>. For demonstration purposes a training and test csv file is stored in resources. This
 approach has to be reevaluated for each new use case, considering data size and confidentiality.</p>
</div>
</div>
<div class="sect2">
<h3 id="_src_the_heart_of_your_service"><a class="anchor" href="#_src_the_heart_of_your_service"></a>src -  the heart of your service</h3>
<div class="paragraph">
<p>The <code>src</code> folder contains the infrastructure coded needed for providing the services in OpenShift
 in <code>src/services</code>. Custom code for developing your prediction service is organized in the
 <code>src/model</code>
 package.
 In the (common) <code>src/requirements.txt</code> you can specify python dependencies for training, prediction
 and tests. To keep it simple, there is only one requirements.txt for both pods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test"><a class="anchor" href="#_test"></a>test</h3>
<div class="paragraph">
<p>The <code>test</code> directory mirrors the structure of the <code>src</code>, either for unittests or integration
tests using the python unittest framework.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_code_your_own_models"><a class="anchor" href="#_how_to_code_your_own_models"></a>How to Code Your Own Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run your own customized models there is usually no need to change either the <code>Jenkinsfile</code>,
OpenShift setup or the training and prediction microservices.
Custom model code will go under <code>src/model</code> and can be organized in custom packages like
showcased with the <code>src/model/data_cleaning</code> and <code>src/model/feature_prep</code>. In general, it can be
organized as
the users prefers.
There are no further restrictions for developing the in the style you want, for the exception to
provide the mandatory functions and attributes in <code>src/model/model_wrapper.py</code> for the `ModelWrapper
class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prep_and_train</code>: is called by the train script (which one can customize) and expects a
pandas dataframe (current implementation). The train script is called by the training service</p>
</li>
<li>
<p><code>prep_and_predict</code>: is called by the predict endpoint service from the prediction service. It
consumes the json post as a dictionary. The predict
endpoint executes <code>prep_and_predict</code>.</p>
</li>
<li>
<p>Good practice: <code>source_features</code>, specifying the name that are used a input for the model. This
features
include really the source columns from which also more complicated features are derived within
the model boundaries</p>
</li>
<li>
<p>Good practice: <code>target_variable</code>, name of the variable that should be used as target for a
possible
supervised approach.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As well as the <code>train</code> function in the <code>src/trainer.py</code>. It specifies how the model should be
trained.</p>
</div>
<div class="paragraph">
<p>Make sure your specified all dependencies in the <code>requirements.txt</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_develop_your_model_locally"><a class="anchor" href="#_how_to_develop_your_model_locally"></a>How to Develop your Model Locally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is recommended to develop your code against the python interpreter &amp; dependencies specified in the docker images.
This can be easily achieved, either by using an IDE that supports that (e.g. PyCharm) or by doing
manually in the docker container.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_versioning"><a class="anchor" href="#_data_versioning"></a>Data Versioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to ensure complete reproducibility, in case train and/or test data can&#8217;t be committed to
 a git repository due to size or confidentiality/data privacy considerations, data versioning can
  be achieved using the built in <a href="https://dvc.org">dvc</a> data version capabilities.`
  Moreover, technical user account is needed so that the CI/CD pipeline is able to pull the data
  dependencies from the remote data versioning repository.</p>
</div>
<div class="paragraph">
<p>Do the following steps in order to make use of the data versioning capabilities</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the quickstarter repository as a <code>dvc</code> repository:
<code>dvc init</code></p>
</li>
<li>
<p>Setup the a remote repository on a remote ssh machine, e.g. Data Lake
<code>dvc remote add &lt;remote_name&gt;  ssh://&lt;remote_server&gt;:/&lt;path_to_storage&gt;</code></p>
</li>
<li>
<p>Configure authentification. For local development you can set your own user account, assuming
it has access to <code>&lt;path_to_storage&gt;</code> or use a technical user account.
<code>dvc remote modify &lt;remote_repository_name&gt; user &lt;technical_user_account&gt;</code>
and set the prompt for password, so that you don&#8217;t commit your password to the repository
<code>dvc remote modify &lt;remote_name&gt; ask_password True</code></p>
</li>
<li>
<p>Start adding files that should be tracked by data versioning
<code>dvc add &lt;some_file&gt;</code>
this will create a new file with meta information about <code>&lt;some_file&gt;</code> called <code>&lt;some_file&gt;.dvc</code>.
This meta file needs to be tracked with git, so that it is ensured that each git commit is linked
 with a specific data version
 <code>git add .gitignore &lt;some_file&gt;.dvc</code></p>
</li>
<li>
<p>Modify your train() and potentially the integration tests to pull the data dependencies from
the remote repository. A helper class is provided in <code>src/services/remote/dvc/data_sync.py</code> that can
 be used as follows:
 <code>from services.infrastructure.remote.dvc.data_sync import DataSync</code>
 <code>syncer = DataSync(dvc_data_repo, dvc_ssh_user, dvc_ssh_password)</code>
<code>syncer.pull_data_dependency(file_name)</code></p>
</li>
<li>
<p>Commit your code and push the data versioned files to the remote repository
<code>git commit</code>
<code>dvc push -r &lt;remote_name&gt;</code>
<code>git push</code></p>
</li>
<li>
<p>In order for a successful Jenkins build, the following environment variables need to be set in
the <code>training</code> pod deployment: <code>DSI_DVC_REMOTE</code>, <code>DSI_SSH_USERNAME</code>, `DSI_SSH_PASSWORD</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_example_dataset"><a class="anchor" href="#_example_example_dataset"></a>Example &amp; Example Dataset</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An example implementation of a custom model is given in <code>src/model</code>, to demonstrate how to organize
custom code.
A Logistic Regression using scikit-learn with some (unnecessary) feature cleaning and engineering
 is trained on the iris data flower set.</p>
</div>
<div class="paragraph">
<p><strong>Iris flower data set</strong>. (n.d.). In Wikipedia. Retrieved January 7, 2019, from <a href="https://en" class="bare">https://en</a>
.wikipedia.org/wiki/Iris_flower_data_set</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_structure_of_the_quick_starter"><a class="anchor" href="#_structure_of_the_quick_starter"></a>Structure of the quick starter</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Training</p>
<div class="ulist">
<ul>
<li>
<p>Build Config</p>
<div class="ulist">
<ul>
<li>
<p>name: <code>&lt;componentId&gt;-training-service</code></p>
</li>
<li>
<p>variables: None</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deployment Config</p>
<div class="ulist">
<ul>
<li>
<p>name: <code>&lt;componentId&gt;-training-service</code></p>
</li>
<li>
<p>variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>DSI_EXECUTE_ON</code>: LOCAL</p>
</li>
<li>
<p><code>DSI_TRAINING_SERVICE_USERNAME</code>: auto generated username</p>
</li>
<li>
<p><code>DSI_TRAINING_SERVICE_PASSWORD</code>: auto generated password</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Route: None by default - no routes exposed to internet</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prediction</p>
<div class="ulist">
<ul>
<li>
<p>Build Config</p>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: <code>&lt;componentId&gt;-prediction-service</code></p>
</li>
<li>
<p><code>variables</code>: None</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deployment Config</p>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: <code>&lt;componentId&gt;-prediction-service</code></p>
</li>
<li>
<p><code>variables</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>DSI_TRAINING_BASE_URL</code>: <code><a href="http://&lt;componentId&gt;-training-service.&lt;env&gt;.svc:8080" class="bare">http://&lt;componentId&gt;-training-service.&lt;env&gt;.svc:8080</a></code></p>
</li>
<li>
<p><code>DSI_TRAINING_SERVICE_USERNAME</code>: username of the training service</p>
</li>
<li>
<p><code>DSI_TRAINING_SERVICE_PASSWORD</code>: password of the training service</p>
</li>
<li>
<p><code>DSI_PREDICTION_SERVICE_USERNAME</code>: auto generated username</p>
</li>
<li>
<p><code>DSI_PREDICTION_SERVICE_PASSWORD</code>: auto generated password</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Route: None by default - no routes exposed to internet</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_remote_training"><a class="anchor" href="#_remote_training"></a>Remote Training</h3>
<div class="paragraph">
<p>Remote training allows you to run your training outside of the OpenShift training pod on a linux
node using a ssh connection.
A conda environment is installed in the remote node and the requirements specified in
<code>src/requirements.txt</code> are installed.
Once this step is finished the training is executed on that node and the trained model is
transferred back to the training pod.</p>
</div>
<div class="paragraph">
<p>To enable remote training set the <code>DSI_EXECUTE_ON</code> variable in OpenShift to <em>SSH</em> and specify the
 connection information in the environment variables: <code>DSI_SSH_HOST</code>, <code>DSI_SSH_PORT</code>,
 <code>DSI_SSH_USERNAME</code> and <code>DSI_SSH_PASSWORD</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_endoints"><a class="anchor" href="#_endoints"></a>Endoints</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_training_endpoint"><a class="anchor" href="#_training_endpoint"></a>Training Endpoint</h3>
<div class="ulist">
<ul>
<li>
<p><code>/</code> : Return all information about the training service</p>
</li>
<li>
<p><code>/start</code> : Starts the training.</p>
</li>
<li>
<p><code>/finished</code> : Checks if the current traning task is finished</p>
</li>
<li>
<p><code>/getmodel</code> : Download the latest trained model</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prediction_endpoint"><a class="anchor" href="#_prediction_endpoint"></a>Prediction Endpoint</h3>
<div class="ulist">
<ul>
<li>
<p><code>/predict</code> : Return all information about the training service</p>
<div class="ulist">
<ul>
<li>
<p>payload: Should be a json containing the data necessary for prediciton. The payload is not pre defined, but it is defined by the trainined model</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is not need for any kind of payload in all endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables_for_training"><a class="anchor" href="#_environment_variables_for_training"></a>Environment Variables for training</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allowed Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_DEBUG_MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables debug mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, 1 our yes for debug mode, otherwise debug is disasbled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_EXECUTE_ON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the train should be executed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCAL, SSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_TRAINING_SERVICE_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to be set as default username for accessing the services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_TRAINING_SERVICE_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to be set as default password for accessing the services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Following variables are applicable if <code>DSI_EXECUTE_ON=SSH</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_HOST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH host name where train should be executed (Only applicable if DSI_EXECUTE_ON=SSH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">host names or ip addresses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH host port where train should be executed (Only applicable if DSI_EXECUTE_ON=SSH)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port numbers (Default: 22)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH username for remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string\</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH password for remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_HTTP_PROXY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP proxy url for remote execution. This is needed if the remote machine needs the proxy for download packages and resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_SSH_HTTPS_PROXY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS proxy url for remote execution. This is needed if the remote machine needs the proxy for download packages and resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_DVC_REMOTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the dvc remote repository that has been initialized with dvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_environment_variables_for_prediction"><a class="anchor" href="#_environment_variables_for_prediction"></a>Environment Variables for prediction</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allowed Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_DEBUG_MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables debug mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, 1 our yes for debug mode, otherwise debug is disasbled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_TRAINING_BASE_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base url where the prediction service should get the model from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">url (e.g. <a href="https://training.OpenShift.svc" class="bare">https://training.OpenShift.svc</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_TRAINING_SERVICE_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username of the training service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_TRAINING_SERVICE_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the training service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_PREDICTION_SERVICE_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to be set as default username for accessing the service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSI_PREDICTION_SERVICE_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to be set as default password for accessing the service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, required</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_this_quickstarter_is_built_through_jenkins"><a class="anchor" href="#_how_this_quickstarter_is_built_through_jenkins"></a>How this quickstarter is built through jenkins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The build pipeline is defined in the <code>Jenkinsfile</code> in the project root. The main stages of the pipeline are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare build</p>
</li>
<li>
<p>Sonarqube checks</p>
</li>
<li>
<p>Build training image</p>
</li>
<li>
<p>Deploy training pod</p>
</li>
<li>
<p>Unittests</p>
</li>
<li>
<p>Execute/reproduce training either on openshift pod or in ssh remote machine</p>
</li>
<li>
<p>Integration test against the newly trained model wrapped in the flask <code>/prediction</code> endpoint</p>
</li>
<li>
<p>Build prediction image</p>
</li>
<li>
<p>Deploy prediction service</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_builder_slave_used"><a class="anchor" href="#_builder_slave_used"></a>Builder slave used</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/opendevstack/ods-project-quickstarters/tree/master/jenkins-slaves/python">jenkins-slave-python</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frameworks_used"><a class="anchor" href="#_frameworks_used"></a>Frameworks used</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Python 3.6</p>
</li>
<li>
<p>Python Flask 1.0.2</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_limitions"><a class="anchor" href="#_known_limitions"></a>Known limitions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Not ready for R models yet</p>
</li>
<li>
<p>In the case of building the docker image from behind a proxy and encountering certificate issues, adding a -k to the curl command can mitigate that, consider however the implications of disabling certificate</p>
</li>
<li>
<p>Consider moving to ssh remote server training, if you expect high and long computational load during training phase. It might cause unnecessary stress on the openshift cluster, otherwise.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/opendevstack/1.x/quickstarters/ds-ml-service.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script>
  tocbot.init( {
                  tocSelector: '#article-toc',
                  contentSelector: 'article',
                  headingSelector: 'h2, h3, h4, h5, h6',
                  collapseDepth: 6,
                  positionFixedSelector: '#article-toc',
                  scrollSmooth: false
                } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
