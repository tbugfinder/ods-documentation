<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Provisioning App: Configuration Guide :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/opendevstack/3.x/provisioning-app/configuration.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opendevstack" data-version="3.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../getting-started/index.html">OpenDevStack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jenkins-shared-library/index.html">Jenkins Shared Library</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins-shared-library/component-pipeline.html">Component Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins-shared-library/orchestration-pipeline.html">Orchestration Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins-shared-library/quickstarter-pipeline.html">Quickstarter Pipeline</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../quickstarters/index.html">Quickstarters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/docker-plain.html">Docker Plain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-gateway-nginx.html">BE Gateway/Nginx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-golang-plain.html">BE Golang</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-java-springboot.html">BE Java/Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-typescript-express.html">BE TypeScript/Express</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-python-flask.html">BE Python/Flask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-scala-play.html">BE Scala/Play</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-angular.html">FE Angular</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-ionic.html">FE Ionic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-ml-service.html">Data Science Machine Learning Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-jupyter-notebook.html">Data Science Jupyter Notebook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-rshiny.html">Data Science RShiny app</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/e2e-cypress.html">Cypress E2E testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/e2e-spock-geb.html">Spock, Geb and Unirest E2E testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/release-manager.html">Release Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jenkins agent Images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins/agent-base.html">Base Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins-agents/golang.html">Go</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins-agents/maven.html">Maven</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins-agents/nodejs10-angular.html">Nodejs10 Angular</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins-agents/python.html">Python</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jenkins-agents/scala.html">Scala</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/authoring-quickstarters.html">Authoring Quickstarters</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Provisioning App</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jenkins/index.html">Jenkins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/master.html">Jenkins Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/agent-base.html">Jenkins Agent Base</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/webhook-proxy.html">Webhook Proxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">SonarQube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Update Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../update-guides/3x.html">Migrate to 3.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../update-guides/2x.html">Migrate to 2.x</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Upgrade</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administration/update-2-to-3.html">2.x to 3.x</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administration/update-older.html">older</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configuration.html">Provisioning App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/keycloak.html">Keycloak</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sonarqube/administration.html">SonarQube</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/administration.html">Jenkins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Contributing to ODS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributing/development.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributing/documentation.html">Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Provisioning App</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenDevStack</span>
    <span class="version">3.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenDevStack</span>
      <ul class="versions">
        <li class="version">
          <a href="../../4.x/getting-started/index.html">4.x Preview</a>
        </li>
        <li class="version is-current is-latest">
          <a href="../getting-started/index.html">3.x</a>
        </li>
        <li class="version">
          <a href="../../2.x/getting-started/index.html">2.x</a>
        </li>
        <li class="version">
          <a href="../../1.x/getting-started/index.html">1.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../getting-started/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../getting-started/index.html">OpenDevStack</a></li>
    <li>Administration</li>
    <li><a href="configuration.html">Provisioning App</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">3.x</button>
  <div class="version-menu">
    <a class="version" href="../../4.x/provisioning-app/configuration.html">4.x Preview</a>
    <a class="version is-current" href="configuration.html">3.x</a>
    <a class="version" href="../../2.x/provisioning-app/configuration.html">2.x</a>
    <a class="version" href="../../1.x/provisioning-app/configuration.html">1.x</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-provisioning-app/edit/3.x/docs/modules/provisioning-app/pages/configuration.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Provisioning App: Configuration Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_quickstarters">Quickstarters</a></li>
<li><a href="#_permissions">Permissions</a></li>
<li><a href="#_projectspace_types_based_on_templates">Project/Space types based on templates</a>
<ul class="sectlevel2">
<li><a href="#_custom_permissions_and_group_to_project_role_mappings">Custom permissions and group-to-project-role mappings</a></li>
<li><a href="#_add_webhook_proxy_url_to_jira_project_properties_based_on_project_type">Add Webhook Proxy URL to jira project properties based on project type</a></li>
</ul>
</li>
<li><a href="#_error_handling">Error Handling</a></li>
<li><a href="#_authentication_configuration">Authentication Configuration</a>
<ul class="sectlevel2">
<li><a href="#_authentication_crowd_configuration">Authentication Crowd Configuration</a></li>
<li><a href="#_authentication_oauth2_configuration">Authentication OAUTH2 Configuration</a></li>
<li><a href="#_basic_auth_authentication">Basic Auth authentication</a></li>
<li><a href="#_authentication_to_third_party_apps_via_technical_users">Authentication to third party apps via technical users</a></li>
</ul>
</li>
<li><a href="#_faq">FAQ</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quickstarters"><a class="anchor" href="#_quickstarters"></a>Quickstarters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Available quickstarters can be provided in the container via <code>/quickstarters/quickstarters.properties</code>. In the context of OpenShift, this file is supplied by the <code>ConfigMap</code> <code>quickstarters.properties</code>. The quickstarters defined there will be displayed to the users in the UI when they modify an existing project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the provisioning app is installed for the first time, a default set of quickstarters (from the <code>ods-quickstarters</code> repository) is seeded. As each installation can configure the available quickstarters differently, the <code>quickstarters.properties</code> <code>ConfigMap</code> is not updated automatically when updating ODS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A quickstarter needs to have two mandatory entries:</p>
</div>
<div class="listingblock">
<div class="title">quickstarters.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jenkinspipeline.quickstarter.&lt;quickstarter-key&gt;.desc=&lt;description&gt;
jenkinspipeline.quickstarter.&lt;quickstarter-key&gt;.repo=&lt;repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">quickstarters.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jenkinspipeline.quickstarter.be-java-springboot.desc=Backend - SpringBoot/Java
jenkinspipeline.quickstarter.be-java-springboot.repo=ods-quickstarters</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that in order to provision the quickstarter, the provisioning app will start a Jenkins pipeline based on the <code>Jenkinsfile</code> located in the <code>opendevstack/ods-quickstarters</code> repository, in the folder <code>be-java-springboot</code>. The UI will display the quickstarter as <code>Backend - SpringBoot/Java</code>.</p>
</div>
<div class="paragraph">
<p>Apart from the required properties, there are also optional properties:</p>
</div>
<div class="listingblock">
<div class="title">quickstarters.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jenkinspipeline.[some-job-name].create-webhook -&gt; whether a default webhook should be created for this repo or not (true by default)
jenkinspipeline.[some-job-name].branch -&gt; a branch differing from ods.git-ref property
jenkinspipeline.[some-job-name].jenkinsfile -&gt; a path to the Jenkinsfile differing from [some-job-name]/Jenkinsfile</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the quickstarter properties are modified, the provisioning app needs to be restarted for the changes to have effect.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_permissions"><a class="anchor" href="#_permissions"></a>Permissions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default no special permissions are set on either confluence / jira / bitbucket or openshift, only system-wide settings are inherited.</p>
</div>
<div class="paragraph">
<p>However there is a special knob to tighten security (which can be passed with the project input <code>createpermissionset : boolean</code>)  - based on three special groups that need to be provided as part of the API call / from the userinterface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>admin group: admin rights on the generated projects / spaces / repositories</p>
</li>
<li>
<p>user group: read / write rights on the generated projects / spaces / repositories</p>
</li>
<li>
<p>readonly group: read rights on the generated projects / spaces / repositories</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration for the permission sets are configured:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JIRA Project is provisioned with its own permissionset defined in <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/resources/permission-templates/jira.permission.all.txt">src/main/resources/permission-templates/jira.permission.all.txt</a></p>
</li>
<li>
<p>Confluence Project is provisioned with special permission set defined in <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/resources/permission-templates">src/main/resources/permission-templates/confluence.permission.*</a></p>
</li>
<li>
<p>Bitbucket Project is provisioned with tight read &amp; write roles</p>
</li>
<li>
<p>Openshift Project roles linked to the passed groups (<code>READONLY</code> - <code>view</code>, <code>ADMINGROUP</code> - <code>admin</code>, <code>USERS</code> - <code>edit</code>)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_projectspace_types_based_on_templates"><a class="anchor" href="#_projectspace_types_based_on_templates"></a>Project/Space types based on templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default jira / confluence project' types are defined in <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/resources/application.properties">src/main/resources/application.properties</a> - and correspondingly in the config maps</p>
</div>
<div class="listingblock">
<div class="content">
<pre>project.template.key.names=default

jira.project.template.key=com.pyxis.greenhopper.jira:gh-scrum-template
jira.project.template.type=software

confluence.blueprint.key=com.atlassian.confluence.plugins.confluence-software-project:sp-space-blueprint</pre>
</div>
</div>
<div class="paragraph">
<p>To add a new template - copy, and add your config, based on a new <code>&lt;project-template-name&gt;</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>jira.project.template.key.&lt;project-template-name&gt;=com.pyxis.greenhopper.jira:gh-scrum-template
jira.project.template.type.&lt;project-template-name&gt;=software

# optional, can stay as is
confluence.blueprint.key.&lt;project-template-name&gt;=com.atlassian.confluence.plugins.confluence-software-project:sp-space-blueprint</pre>
</div>
</div>
<div class="paragraph">
<p>and add the new <project-template-name>from above to the existing property <code>project.template.key.names</code></name></p>
</div>
<div class="listingblock">
<div class="content">
<pre># list of templates surfaced to the UI and API
project.template.key.names=default,&lt;project-template-name&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_custom_permissions_and_group_to_project_role_mappings"><a class="anchor" href="#_custom_permissions_and_group_to_project_role_mappings"></a>Custom permissions and group-to-project-role mappings</h3>
<div class="paragraph">
<p>Custom permission configuration makes possible to configure each Project type template with a specific <code>permission-scheme-id</code> on project creation.</p>
</div>
<div class="paragraph">
<p>Any new Jira project of a specific project type will be then set with the same <code>permission-schemed-id</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, mappings of project roles to the special groups (defined above: admin, user and readonly group) have to be configured, so that the special groups are added to the jira project roles of the new project.</p>
</div>
<div class="paragraph">
<p>These capabilities make possible for Jira Admin to define a main permission scheme that will be "reused" for every new project. Another big benefit is that release them from the manual task of mapping the special groups to the permission scheme project roles.</p>
</div>
<div class="sect3">
<h4 id="_project_type_custom_permissions_scheme_id_configuration"><a class="anchor" href="#_project_type_custom_permissions_scheme_id_configuration"></a>Project type custom permissions scheme id configuration</h4>
<div class="paragraph">
<p>To configure a <code>project-template-name</code> with a specific <code>permission-schemed-id</code> you need to add these properties to your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jira.project-templates.&lt;project-template-name&gt;.name=UTest project template
jira.project-templates.&lt;project-template-name&gt;.permission-scheme-id=&lt;PERMISSION_SCHEME_ID&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if the <code>permission-scheme-id</code> is configured you will have to provide group-to-project-role mapping configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_project_type_group_to_project_role_mappings"><a class="anchor" href="#_project_type_group_to_project_role_mappings"></a>Project type group-to-project-role mappings</h4>
<div class="paragraph">
<p>If a <code>permission-schemd-id</code> is defined, then the following <code>project-to-*</code> properties have to be configured. Otherwise the provisioning app will fail to start.</p>
</div>
<div class="paragraph">
<p>Like the <code>permission-scheme-id</code> the value of these properties has to be in this case an existant <code>project role id</code> in Jira, that you will need to get from your Jira server in advance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jira.project-project-template-name.&lt;&gt;.role-mapping.project-role-for-admin-group=&lt;ROLE_ID&gt;
jira.project-project-template-name.&lt;&gt;.role-mapping.project-role-for-user-group=&lt;ROLE_ID&gt;
jira.project-project-template-name.&lt;&gt;.role-mapping.project-role-for-readonly-group=&lt;ROLE_ID&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_overwriting_custom_permissions_scheme_id_and_group_to_project_role_mappings_per_api_call"><a class="anchor" href="#_overwriting_custom_permissions_scheme_id_and_group_to_project_role_mappings_per_api_call"></a>Overwriting custom permissions scheme id and group-to-project-role mappings per API call</h4>
<div class="paragraph">
<p>Another way to set a <code>permission-scheme-id</code> with the corresponding <code>project-to-role-*</code> mappings is by API call.
You can define following properties in the payload of the create project API call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{
    ...
    "specialPermissionSchemeId": "&lt;PERMISSION_SCHEME_ID&gt;"
    "projectRoleForAdminGroup": "&lt;ROLE_ID&gt;",
    "projectRoleForUserGroup": "&lt;ROLE_ID&gt;",
    "projectRoleForReadonlyGroup": "&lt;ROLE_ID&gt;",
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A given <code>&lt;project-template-name&gt;</code> configuration will be overwritten by these payload properties.</p>
</div>
<div class="paragraph">
<p>You will find more details about the provisioning app REST API in this section: <a href="architecture.html#_consuming_rest_apis_via_curl" class="page">Consuming REST APIs via curl</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no <code>permission-scheme-id</code> with the corresponding <code>project-to-role-*</code> mappings are provided neither by configuration nor in the create project payload, then the default behaviour will be applied, which in this case will create a new permission scheme as explained in the section Permissions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_webhook_proxy_url_to_jira_project_properties_based_on_project_type"><a class="anchor" href="#_add_webhook_proxy_url_to_jira_project_properties_based_on_project_type"></a>Add Webhook Proxy URL to jira project properties based on project type</h3>
<div class="paragraph">
<p>It is possible to configure the Provisioning App to add to jira project the Webhook Proxy URL as project property.
Jira provides an REST API for this purpose (<a href="https://docs.atlassian.com/software/jira/docs/api/REST/8.5.3/#api/2/project/{projectIdOrKey}/properties-setProperty)">Jira Properties API</a>)</p>
</div>
<div class="paragraph">
<p>This functionality can be configured for each project type.
To enable this you will need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable this capability for a given project type add the a property like:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jira.project.template.add-webhook-proxy-url-as-project-property.&lt;project-template-name&gt;=true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the jira endpoint as template by adding this property:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jira.project.template.webhook-proxy-url-endpoint-template.&lt;project-template-name&gt;=/api/2/project/%PROJECT_KEY%/properties/WEBHOOK_PROXY.URL</code></pre>
</div>
</div>
<div class="paragraph">
<p>These 2 template keys <code>%PROJECT_KEY%</code> and <code>%PROPERTY_VALUE%</code> can be defined and will be replaced will real values.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the jira endpoint payload as template that will be added to the set jira property endpoint call</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jira.project.template.webhook-proxy-url-payload-template.&lt;project-template-name&gt;={\"WEBHOOK_PROXY.URL\", \"%PROPERTY_VALUE%\"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the payload template also these 2 template keys <code>%PROJECT_KEY%</code> and <code>%PROPERTY_VALUE%</code> can be defined and will be replaced will real values.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling"><a class="anchor" href="#_error_handling"></a>Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Up to (and including) <em>v1.1.x</em> when provisioning failed, corrupt and inconsistent states where left in the bugtracker system, bitbucket etc. which had do be cleaned up <em>manually</em> based on logs. This is rectified and a the new <code>default</code> behavior is to see every post to the API as <code>atomic</code> unit of work, which in case of failure is tried to be cleaned up (alike functional rollback). This behavior can be turned <em>off</em> by specifying the new property
<em>provision.cleanup.incomplete.projects</em> and setting it to <em>false</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_configuration"><a class="anchor" href="#_authentication_configuration"></a>Authentication Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are to separate authentication options to authenticated a user for the provisioning app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CROWD (default)</p>
</li>
<li>
<p>OAUTH2</p>
</li>
<li>
<p>Basic Auth</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="&#128161;"></i>
</td>
<td class="content">
Note that the current OAUTH2 implementation is only used for authentication the user to the provisioning app.
To authentication that is used for the REST - API calls of Atlassian Crowd, Jira, Confluence and Bitbucket is done eighter via the logged in uses credentials (user name and password) or via the technical users, that are configured in the used spring boot profile.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_authentication_crowd_configuration"><a class="anchor" href="#_authentication_crowd_configuration"></a>Authentication Crowd Configuration</h3>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">provision.auth.provider=crowd <i class="conum" data-value="1"></i><b>(1)</b>
spring.profiles.active=crowd <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>configures crowd authentication provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>include crowd profile per default.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The crowd specific configuration is done in the included profile <em>crowd</em>, see property documentation inside the profile file <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/test/resources/application-crowd.properties">application-crowd.properties</a>. The provided example configuration is appropriate for a locally installed OpenDevStack environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_oauth2_configuration"><a class="anchor" href="#_authentication_oauth2_configuration"></a>Authentication OAUTH2 Configuration</h3>
<div class="paragraph">
<p>An example of plain oauth2 configuration is given in spring boot profile <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/resources/application-oauth2.properties">application-oauth2.properties</a>. The provided example configuration is appropriate for a locally installed OpenDevStack environment, when the <em>idmanager</em> vagrant box is used.</p>
</div>
<div class="listingblock">
<div class="title">application-oauth2.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">provision.auth.provider=oauth2 <i class="conum" data-value="1"></i><b>(1)</b>

idmanager.url=http://192.168.56.32:8080 <i class="conum" data-value="2"></i><b>(2)</b>
idmanager.realm=provisioning-app <i class="conum" data-value="3"></i><b>(3)</b>

oauth2.user.roles.jsonpointerexpression=/claims/roles <i class="conum" data-value="4"></i><b>(4)</b>

<i class="conum" data-value="5"></i><b>(5)</b>
spring.security.oauth2.client.registration.keycloak.client-id=ods-provisioning-app
spring.security.oauth2.client.registration.keycloak.client-secret=put-your-secret-here
spring.security.oauth2.client.registration.keycloak.clientName=ods-provisioning-app
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirectUri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.keycloak.scope=openid

<i class="conum" data-value="6"></i><b>(6)</b>
spring.security.oauth2.client.provider.keycloak.authorization-uri=${idmanager.url}/auth/realms/${idmanager.realm}-app/protocol/openid-connect/auth
spring.security.oauth2.client.provider.keycloak.token-uri=${idmanager.url}/auth/realms/${idmanager.realm}/protocol/openid-connect/token
spring.security.oauth2.client.provider.keycloak.user-info-uri=${idmanager.url}/auth/realms/${idmanager.realm}/protocol/openid-connect/userinfo
spring.security.oauth2.client.provider.keycloak.jwk-set-uri=${idmanager.url}/auth/realms/${idmanager.realm}/protocol/openid-connect/certs
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>configures oauth2 authentication provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>URL to idmanager. The value defaults to opendevstack idmanager box with keycloak installation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Name of realm that is used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The application reads the user roles from the claim that is inside the oauth2 ID-Token. The property <em>oauth2.user.roles.jsonpointerexpression</em> is a JsonPointer - Expression that defines a path to the roles that are extracted from the id token. Details regarding pointer expression can be found at <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/https://fasterxml.github.io/jackson-core/javadoc/2.5/com/fasterxml/jackson/core/JsonPointer.html">Jackson-core JsonPointer Documentation</a></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Defines the OAUTH2 client registration properties, in particular the client name and client secret. See
<a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/https://docs.spring.io/spring-security/site/docs/5.1.5.RELEASE/reference/html/jc.html#oauth2login-boot-property-mappings">OAUTH2 Spring Boot 2.x Property Mappings</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Defines the OAUTH2 <em>client.provider</em> properties. These properties correspond to the <em>well-known</em> OAUTH2-URIs. In case of keycloak, this URIs can be read out using the  <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/http://192.168.56.32:8080/auth/realms/provisioning-app/.well-known/openid-configuration">.well-known/openid-configuration-link</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively if your identity provider is Azure AD, a configuration example is given in <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/resources/application-azure.properties">application-azure.properties</a></p>
</div>
<div class="listingblock">
<div class="title">application-azure.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">provision.auth.provider=oauth2 <i class="conum" data-value="1"></i><b>(1)</b>
provision.auth.provider.oauth2.user-info-uri=userInfo <i class="conum" data-value="2"></i><b>(2)</b>

<i class="conum" data-value="3"></i><b>(3)</b>
# Application ID (also called Client ID)
spring.security.oauth2.client.registration.azure.client-id=&lt;CLIENT_ID&gt;&gt;
spring.security.oauth2.client.registration.azure.client-secret=&lt;CLIENT_SECRET&gt;

# It's suggested the logged in user should at least belong to one of the below groups
# If not, the logged in user will not be able to access any authorization controller rest APIs
azure.activedirectory.user-group.allowed-groups=opendevstack-administrators,opendevstack-users <i class="conum" data-value="4"></i><b>(4)</b>
azure.activedirectory.environment=global-v2-graph
azure.activedirectory.user-group.key=@odata.type
azure.activedirectory.user-group.value=#microsoft.graph.group
azure.activedirectory.user-group.object-id-key=id
azure.activedirectory.tenant-id=&lt;TENANT_ID&gt; <i class="conum" data-value="5"></i><b>(5)</b>

oauth2.user.roles.jsonpointerexpression=/claims/roles <i class="conum" data-value="6"></i><b>(6)</b>
oauth2.user.use-email-claim-as-username=true <i class="conum" data-value="7"></i><b>(7)</b>

<i class="conum" data-value="8"></i><b>(8)</b>
idmanager.url=https://login.microsoftonline.com
idmanager.realm=${spring.security.oauth2.client.registration.azure.client-id}

idmanager.disable-logout-from-idm=true <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>configures oauth2 authentication provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>configure user info uri</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>registers in spring security azure oauth2 client id and secret</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>configure allow groups</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>register azure ad tenant</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the application reads the user roles from the claim that is inside the oauth2 ID-Token. The property <em>oauth2.user.roles.jsonpointerexpression</em> is a JsonPointer - Expression that defines a path to the roles that are extracted from the id token. Details regarding pointer expression can be found at <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/https://fasterxml.github.io/jackson-core/javadoc/2.5/com/fasterxml/jackson/core/JsonPointer.html">Jackson-core JsonPointer Documentation</a></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>configure to use email claim as username</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>configure name of the ProvApp realm</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>instruct ProvApp to not logout from identity management provider</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_basic_auth_authentication"><a class="anchor" href="#_basic_auth_authentication"></a>Basic Auth authentication</h3>
<div class="paragraph">
<p>This option can be enabled to activate basic auth as additional authentication when using <code>crowd</code> or <code>oauth2</code> as authentication provider.</p>
</div>
<div class="paragraph">
<p>To enable basic auth this properties needs to be configured:</p>
</div>
<div class="listingblock">
<div class="title">application-azure.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">provision.auth.basic-auth.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic auth authentication needs to connect to an identity manager to authenticate users.
Currently only <code>crowd</code> is supported for this purpouse.
If you have&#8217;ve chosen to use <code>oauth2</code> as provider you can even enable basic auth to connect to crowd server.
For that you will need to add these properties to your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># crowd properties (needed for basic auth)
crowd.local.directory=~/dev/temp
crowd.application.name=&lt;APPLICATION_NAME&gt;
crowd.application.password=&lt;PASSWORD&gt;
crowd.server.url=&lt;CROWD_HOST&gt;
crowd.cookie.domain=&lt;COOKIE_DOMAIN&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_to_third_party_apps_via_technical_users"><a class="anchor" href="#_authentication_to_third_party_apps_via_technical_users"></a>Authentication to third party apps via technical users</h3>
<div class="paragraph">
<p>The rest api calles use HTTP <em>basic access authentication</em> to communicate with Jira, Confluence and Bitbucket. The used credentials are read from a pair of properties. For Example, <em>bitbucket.admin_password</em> and <em>bitbucket.admin_user</em> properties are used for Bitbucket, <em>confluence.admin_user</em> and <em>confluence.admin_password</em> are used for Confluence, etc.</p>
</div>
<div class="listingblock">
<div class="title">application-oauth2.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># configure technical user for bitbucket. Do not authenticate via oauth2, since not implemented.
bitbucket.admin_password=bitbucket_admin
bitbucket.admin_user=bitbucket_admin

# configure technical user for confluence. Do not authenticate via oauth2, since not implemented.
confluence.admin_password=confluence_admin
confluence.admin_user=confluence_admin

# configure technical user for jira. Do not authenticate via oauth2, since not implemented.
jira.admin_password=jira_admin
jira.admin_user=jira_admin</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="&#128161;"></i>
</td>
<td class="content">
Note: if the pair of properties is not defined for a third party tool, the logged in user&#8217;s credentials are used to authenticate against the application.
The credentials are read by caling the method <em>getUserName</em> and <em>getUserPassword</em> from <a href="https://github.com/opendevstack/ods-provisioning-app/blob/master/src/main/java/org/opendevstack/provision/adapter/IODSAuthnzAdapter">IODSAuthnzAdapter</a>]. See also implementation of <em>org.opendevstack.provision.services.BaseServiceAdapter#authenticatedCall()</em>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq"><a class="anchor" href="#_faq"></a>FAQ</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Where is the provision app deployed?<br></p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>the provision application is deployed on openshift, in both <code>prov-dev</code> and <code>prov-test</code>. <code>prov-dev</code> is the development environment in case you want to change / enhance the application, while the production version of the application is deployed in <code>prov-test</code>. The URL to get to the provision application, is defined thru a route. Ít&#8217;s <code>https://prov-app-test.</code><openshift application="" domains="">.</openshift></p>
</li>
</ol>
</div>
</li>
<li>
<p>Where do I find the logs, if something went wrong?<br></p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Within the Openshift <code>pod</code> of the provision app (in <code>project</code>dev/test, namely in <code>/opt/provision/history/logs</code> a logfile is created per <code>project</code>)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Where is the real configuration of the provision application?<br></p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>The base configuration in the the <code>application.properties</code> in the codebase, the setup specific one is in a config map deployed within the <code>prov-dev/test</code> project.</p>
</li>
</ol>
</div>
</li>
<li>
<p>What is the default permission schema in Jira?<br></p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>the default permission schema in Jira is named <code>Default Permission Scheme</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Which role is missing in Jira default permission schema if the project creator cannot access it?<br></p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>The default permission schema named <code>Default Permission Scheme</code> needs the role <code>owner</code> to be added to permission <code>Browser Projects</code>. Otherwise the project creator (role <code>owner</code>) will not be able to access the project.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/opendevstack/3.x/provisioning-app/configuration.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script>
  tocbot.init( {
                  tocSelector: '#article-toc',
                  contentSelector: 'article',
                  headingSelector: 'h2, h3, h4, h5, h6',
                  collapseDepth: 6,
                  positionFixedSelector: '#article-toc',
                  scrollSmooth: false
                } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
